---
title: 监控Redis
date: 2022-03-22 14:01:17
permalink: /pages/125aff/
---


<p align="center"><img src="/img/prometheus.jpg" width="auto" style="cursor: zoom-in;"></p>


## 客户端（Docker版）
在客户端服务器运行以下命令，启用健康探针
```bash
docker run -d --name redis_exporter \
-p 9105:9121 \
oliver006/redis_exporter --redis.addr redis://192.168.2.3:6379 --redis.password '123456'
```

> 浏览器访问IP:9105 查看, 默认是9121端口,本文使用9105端口

## 服务端
进入prometheus服务端配置文件
```yaml
vim /data/docker/prometheus/prometheus.yml

scrape_configs:
  ***注意默认有一个prometheus的job任务***
  # Redis监控组
  - job_name: "redis-sit"
    static_configs:
    - targets: ['192.168.2.4:9105']
```

## 监控Redis集群
切记注意yml的格式缩进问题！！！
```yaml
vim /data/docker/prometheus/prometheus.yml

scrape_configs:
  ***注意默认有一个prometheus的job任务***
  # Redis监控组
  - job_name: 'redis_exporter_targets'
    static_configs:
      - targets:
        - redis://172.18.11.139:7000
        - redis://172.18.11.139:7001
        - redis://172.18.11.140:7002
        - redis://172.18.11.140:7003
        - redis://172.18.11.141:7004
        - redis://172.18.11.141:7005
    metrics_path: /scrape
    relabel_configs:
      - source_labels: [__address__]
        target_label: __param_target
      - source_labels: [__param_target]
        target_label: instance
      - target_label: __address__
        replacement: 172.18.11.139:9121
```

启动Redis_exporter的命令如下：
只要能连接到一个集群的一个节点，自然就能查询其他节点的指标了。

```bash
docker run -d --name redis_exporter -p 9121:9121 \
oliver006/redis_exporter --redis.addr redis://172.16.11.51:6379 --redis.password '123456'
```

重载Prometheus配置
```bash
# 重启容器
docker restart prometheus
# 重载 (可能无效)
curl -XPOST http://127.0.0.1:9090/-/reload
```
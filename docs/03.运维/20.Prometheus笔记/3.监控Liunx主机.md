---
title: 监控Liunx主机
date: 2022-03-21 11:12:40
permalink: /pages/25f737/
---

## 客户端（Docker版）
在客户端服务器运行以下命令，启用健康探针
```bash
docker run -d --hostname `hostname` --name node-exporter \
--cpus=2 --restart=on-failure:3 \
  --net="host" \
  --pid="host" \
  --restart=always \
  -v "/:/host:ro,rslave" \
  quay.io/prometheus/node-exporter:latest \
  --path.rootfs=/host
```

> 浏览器访问IP:9100 查看

## 服务端
进入prometheus服务端配置文件

vim /data/docker/prometheus/prometheus.yml
```yaml
scrape_configs:
  ***注意默认有一个prometheus的job任务***
  - job_name: 'host'
    file_sd_configs:
    - files:
      - /etc/prometheus/job/host.json
      refresh_interval: 1m
```
新建监控项
```yaml
cat /data/docker/prometheus/job/host.json

# Json格式
[
  {
    "targets": [ "172.17.80.69:9100"],
    "labels": {
      "app": "Node_exporter",
      "nodename": "Prod-001",
      "subject": "服务器"
    }
  },
  {
    "targets": [ "172.17.227.109:9100"],
    "labels": {
      "app": "Node_exporter",
      "nodename": "Prod-002",
      "subject": "服务器"
    }
  }
]
```

重载Prometheus配置
```bash
# 重启容器
docker restart prometheus
# 重载 (可能无效)
curl -XPOST http://127.0.0.1:9090/-/reload
```
---
title: 使用InfluxDB长期存储
date: 2022-03-23 11:28:49
permalink: /pages/1d2f4a/
---


<p align="center"><img src="/img/prometheus.jpg" width="auto" style="cursor: zoom-in;"></p>


# 部署influxDB 1.8
```
# 配置文件
cat /data/docker/influxdb/influxdb.conf
[meta]
  dir = "/var/lib/influxdb/meta"
[data]
  dir = "/var/lib/influxdb/data"
  wal-dir = "/var/lib/influxdb/wal"
  series-id-set-cache-size = 100
[http]
   enabled = true
   # auth-enabled = true  # 新建完管理员再启用
   bind-address = ":12500"

# 容器启动
docker run -d --name influxdb \
--cpus=2 -m 4G --restart=on-failure:3 \
-p 12500:12500 -p 8083:8083 \
-v /data/docker/influxdb/influxdb.conf:/etc/influxdb/influxdb.conf:ro  \
-v /data/docker/influxdb/:/var/lib/influxdb \
-v /etc/localtime:/etc/localtime \
influxdb:1.8-alpine
```

## influxDB基本使用
```
# 查看版本
docker exec influxdb influxd version

# 新建普通用户
docker exec -it influxdb  influx -port 12500 -precision rfc3339

# 进行身份认证
auth

# 创建数据库
create database prometheus                                                 

# 新建管理员
create user "root" with password 'root' with all privileges      

# 新建用户
create user prom with password 'prom'                    

# 将数据库赋权给用户
grant all on prometheus to prom         
```

## Prometheus配置
在底部加入
```
vim /data/docker/prometheus/prometheus.yml

remote_write:
  - url: "http://192.168.2.4:12500/api/v1/prom/write?db=prometheus&u=prom&p=prom"

remote_read:
  - url: "http://192.168.2.4:12500/api/v1/prom/read?db=prometheus&u=prom&p=prom"
```